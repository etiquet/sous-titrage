	PRINT	PUSH,OFF				INCLUDE	'ToolEqu.a'	INCLUDE	'Traps.a'	INCLUDE	'PackMacs.a'	INCLUDE	'QuickEqu.a'	INCLUDE	'SysEqu.a'	INCLUDE	'BB.Records.a'	INCLUDE	'StandardFile.a'		INCLUDE	'PackMacs.a'	INCLUDE	'intenv.a'		; so we can get our args, open files, etc.	INCLUDE	'signal.a'		; so we can handle 'Command-.'	INCLUDE	'PrEqu.a'	PRINT	POP				IMPORT	qd:QDGlobals	IMPORT	G:AppGlobals							* ===========================================*	Procedure DrawServiceWindow()* ===========================================**	cette routine affiche certaines variables globales rel (a5) du programmes*	;			SEG	'Affichage'			DrawServiceWindow				PROC	EXPORTStackFrame	RECORD	{A6Link},DECR		; build a stack frame recordParamBegin	EQU	*			; start parameters after this pointParamSize	EQU	ParamBegin-*		; size of all the passed parametersRetAddr 	DS.L	1			; place holder for return addressA6Link		DS.L	1			; place holder for A6 linkNumST		ds.w	1			; position du controle vertical (n¡ 1 st affichŽ) 								; emplacement pour stocker la taille et positionRectfenetre	DS		RECT		; de la fentre 								; emplacement pour stocker la taille et positionRectangle	DS		rect		; de la fentrenbDeStAafficher		ds.w	1	; nombre de sous titre ˆ affichertextBuff	ds.b	256LocalSize	EQU 	*			; size of all the local variables		ENDR		WITH	StackFrame,SOUSTITRERECORD,AppGlobals		; cover our local stack frame		LINK	A6,#LocalSize		; allocate our local stack frame		IMPORT	ConversionNumeroSTPointeur,ConversionTCstASCII, \				AdditionTimeCode,SoustractionTimeCode,ConversionTimeCode_Trames,\				TrouveString						movem.l	d0-d7/a0-a4,-(sp)	; sauvegarde des registres 		pea		G.ServiceWindow		_SetPort		lea.l	G.ServiceWindow,a0		; transfert de rect dans buffer temporaire		move.l	portRect(a0),Rectfenetre(a6)			move.l	portRect+4(a0),Rectfenetre+4(a6)		; initialisation de quick-draw de la police et tout et tout		_PenNormal		MOVE.W		#SrcCopy,-(SP)					; source mode		_TextMode		MOVE.W		#Monaco,-(SP)					; Monaco		_TextFont		MOVE.W		#9,-(SP)						; 9 point		_TextSize		MOVE.W		#0,-(SP)						; plain		_TextFace		move.w	#1,-(sp)	   	move.w	#1,-(sp)	   	_PenSize	   	move.w	#SrcCopy,-(sp)	   	_PenMode; ---				move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#65,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo				pea	#'----------------------------------------------'		_drawString; ---						move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#80,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo						pea	#'Type de Macintosh: ('		_drawString								move.w	G.Mac.MachineType,d0		lea	textBuff(a6),a0		clr.w	-(sp)		_Pack7				pea	textBuff(a6)		_DrawString				pea	#')  =>  '		_drawString				move.w	G.Mac.MachineType,d0 		addq.w	#1,d0	; le zŽro est possible		lea		MacType(pc),a0		jsr		TrouveString		cmp.l	#0,a0		beq.s	Err1		move.l	a0,-(sp)		_DrawStringErr1; ---				move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#95,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo						pea		#'Systme d exploitation:'		_drawString				move.w	G.Mac.SystemVersion,d0		lsr.w	#8,d0		and.l	#$ff,d0		lea		textBuff(a6),a0		clr.w	-(sp)		_Pack7					pea		textBuff(a6)		_DrawString				pea	#'.'		_DrawString						move.w	G.Mac.SystemVersion,d0		and.l	#$ff,d0		lea		textBuff(a6),a0		clr.w	-(sp)		_Pack7			pea		textBuff(a6)		_DrawString		; ----------			move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#110,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo		pea	#'Microprocesseur: '		_drawString;							move.w	G.Mac.Processor,d0		addq.w	#1,d0	; le zŽro est possible		lea		MPUType(pc),a0		jsr		TrouveString		cmp.l	#0,a0		beq.s	Err2		move.l	a0,-(sp)		_DrawString				Err2		; --------------		move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#125,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo				tst.b	G.Mac.HasFPu		bne.s	FPu				pea	#'FPU prŽsent: non   '		_drawString			bra.s	PasFPUFPU				pea	#'FPU prŽsent: oui   '		_drawString					PasFPu		; -----------------		move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#140,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo		pea		#'Type de Clavier: ('		_DrawString		move.w	G.Mac.KeyBoardType,d0		lea	textBuff(a6),a0		clr.w	-(sp)		_Pack7				pea	textBuff(a6)		_DrawString				pea	#')  =>  '		_drawString								move.w	G.Mac.KeyBoardType,d0		addq.w	#1,d0	; le zŽro est possible		lea		KeyboardType(pc),a0		jsr		TrouveString		cmp.l	#0,a0		beq.s	Err3		move.l	a0,-(sp)		_DrawString		Err3		; -----------------		move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#155,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo													tst.b	G.Mac.HasCOloRQD		beq.s	PasColoRQuickdraw						pea	#'Color QUICKDRAW: oui '				_DrawString			bra	suiteQD			PasColoRQuickdraw				pea	#'Color QUICKDRAW: non   '				_DrawString		suiteQD				move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#170,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo							pea	#'Version Environs: '		_DrawString				move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8+120,d6		add.w	#170,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo					move.w	G.Mac.EnvironsVersion,d0		and.l	#$ffff,d0		lea		textBuff(a6),a0		clr.w	-(sp)		_Pack7				pea		textBuff(a6)		_drawString				move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#185,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo				pea	#'----------------------------------------------'		_drawString		move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#200,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo						pea		#'mpu speed (dbra/msec) :'		_DrawString				move.w	TimeDBRA,d0          ;Number of times the DBRA instruction can,d0		and.l	#$ff,d0		lea		textBuff(a6),a0		clr.w	-(sp)		_Pack7			pea		textBuff(a6)		_DrawString						move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#215,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo						pea		#'SCC access speed (count/msec) :'		_DrawString				move.w	TimeSCCDB,d0         ;Number of times the SCC can be accessed		and.l	#$ff,d0		lea		textBuff(a6),a0		clr.w	-(sp)		_Pack7			pea		textBuff(a6)		_DrawString						move.w	Left+Rectfenetre(a6),d6		move.w	Top+Rectfenetre(a6),d7		add.w	#8,d6		add.w	#230,d7		move.w	d6,-(sp)		move.w	d7,-(sp)		_MoveTo         pea		#'SCSI access speed (count/msec) :'		_DrawString				move.w	$DA6,d0       ;Number of times the SCSI can be accessed  		and.l	#$ff,d0		lea		textBuff(a6),a0		clr.w	-(sp)		_Pack7			pea		textBuff(a6)		_DrawString							Exit	MOVEM.L	(SP)+,D0-D7/A0-A4		UNLK	A6			; destroy the link		MOVEA.L	(SP)+,A0		; pull off the return address		ADDA.L	#ParamSize,SP		; strip all of the caller's parameters		JMP	(A0)			; return to the caller		string pascalMacType	dc.W	25		dc.b	'Macintosh ???'  		dc.b	'Macintosh 512K enhanced'  		dc.b	'Macintosh Plus'  		dc.b	'Macintosh SE'  		dc.b	'Macintosh II'  		dc.b	'Macintosh IIx'  		dc.b	'Macintosh IIcx'  		dc.b	'Macintosh SE/30'  		dc.b	'Macintosh Portable'  		dc.b	'Macintosh IIci'		dc.b	' '		dc.b	'Macintosh IIfx'			;11		dc.b	'Macintosh Classic '		;12		dc.b	' ?'		dc.b	' ?'		dc.b	' ?'		dc.b	'?? '					;16		dc.b	'Macintosh LC II'			;17		dc.b	' '		dc.b	'Macintosh	PowerBook 170 '	;19		dc.b	' '		dc.b	' '		dc.b	'Macintosh	PowerBook 100 '	;22		dc.b	'Macintosh	Quadra	900 '	;23		dc.b	'Macintosh	Quadra	950 '	;24		KeyboardType			dc.W	14 		dc.b	'envUnknownKbd' 		dc.b	'Macintosh keyboard'  		dc.b	'Macintosh keyboard and keypad'  		dc.b	'Macintosh Plus keyboard'  		dc.b	'Apple Extended keyboard'  		dc.b	'Apple Standard keyboard'  		dc.b	'Macintosh Portable keyboard'  		dc.b	'Macintosh Portable keyboard (ISO)'  		dc.b	'Apple Standard keyboard (ISO)'  		dc.b	'Apple Extended keyboard (ISO)'		dc.b	' '		dc.b	'Apple low cost keyboard'		dc.b	' '		dc.b	'apple portable keyboard'MPUType			dc.W	6	 	dc.b	'MC ?????' 		dc.b	'MC 68000 ' 		dc.b	'MC 68010 ' 		dc.b	'MC 68020 ' 		dc.b	'MC 68030 ' 		dc.b	'MC 68040 '		align 4		DbgInfo.New	DrawServiceWindow		ENDP							* ===========================================*	Procedure TrouveString()* ===========================================**	cette routine affiche certaines variables globales rel (a5) du programmes*				TrouveString				PROC	EXPORT						movem.l	d1,-(sp)	; sauvegarde des registres 		; on commence par tester si le numŽro > nombre de chaines dans la liste 					cmp.w	(a0),d0		bhi.s	PasDansLaListe		cmp.w	#1,d0		beq.s	PasDansLaListe	; le premier texte		add.l	#2,a0		; on pointe sur le premier texte		sub.w	#2,d0		loop	moveq	#0,d1		move.b	(a0),d1			add.l	d1,a0		add.l	#1,a0		dbra.w	d0,loop		bra.s	Exit			PasDansLaListe		add.l	#2,a0		; le premier texteExit	MOVEM.L	(SP)+,D1		rts							; return to the caller				DbgInfo.new		TrouveString		align	4		endp			end	